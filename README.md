# Aircraft Temp App

A Vite + React single-page app for tracking cabin temperatures and nighttime aircraft prep. The app now uses Supabase as the backing data store for the "Supabase Demo" view and is ready to deploy to Azure Static Web Apps (or any static host).

## Prerequisites
- Node.js 18+
- A Supabase project with anon and service keys
- Optional: Azure CLI if deploying to Azure Static Web Apps

## Environment variables
Create a `.env.local` (or configure Azure app settings) with:

```
VITE_SUPABASE_URL=https://<your-project>.supabase.co
VITE_SUPABASE_ANON_KEY=<anon-key>
# Optional: defaults to OMA if omitted
VITE_DEFAULT_STATION=OMA
```

## Supabase schema
Run the SQL below inside the Supabase SQL editor to create the tables used by the app:

```sql
create table if not exists night_tails (
  id bigint generated by default as identity primary key,
  station text not null,
  night_date date not null,
  tail_number text not null,
  location text,
  heat_source text,
  drained boolean default false,
  marked_in_at timestamp with time zone,
  purged_at timestamp with time zone,
  created_at timestamp with time zone default now()
);

create table if not exists temp_logs (
  id bigint generated by default as identity primary key,
  station text not null,
  night_date date not null,
  tail_number text not null,
  temp_f numeric not null,
  recorded_at timestamp with time zone default now()
);

alter table night_tails enable row level security;
alter table temp_logs enable row level security;

-- Simple unauthenticated access for demos; tighten for production
create policy "Anon insert night tails" on night_tails
  for insert to anon using (true) with check (true);
create policy "Anon read night tails" on night_tails
  for select to anon using (true);
create policy "Anon update night tails" on night_tails
  for update to anon using (true) with check (true);

create policy "Anon insert temp logs" on temp_logs
  for insert to anon using (true) with check (true);
create policy "Anon read temp logs" on temp_logs
  for select to anon using (true);
```

## Local development
```
npm install
npm run dev
```
The Supabase demo tab will work once the environment variables are provided.

## Deploying to Azure Static Web Apps
1. Build the app locally to verify: `npm run build` (output in `dist/`).
2. Create or reuse a Static Web App resource. Use the following settings:
   - **App location:** `/`
   - **Output location:** `dist`
   - **Build command:** `npm run build`
3. Configure the required app settings so the frontend can reach Supabase:
   ```bash
   az staticwebapp appsettings set \
     --name <your-swa-name> \
     --setting-names \
       VITE_SUPABASE_URL=https://<your-project>.supabase.co \
       VITE_SUPABASE_ANON_KEY=<anon-key> \
       VITE_DEFAULT_STATION=OMA
   ```
4. Deploy using GitHub Actions (created automatically by Azure) or run `az staticwebapp deploy` if pushing from CI/CLI.

## Notes
- The Supabase data helpers use the REST interface with the anon key; ensure your RLS policies permit the operations above.
- For production, replace the demo policies with scoped policies (e.g., authenticated users, role checks, station-based filters).
